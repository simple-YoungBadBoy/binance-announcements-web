<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Binance 公告历史</title>
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; margin: 0; padding: 16px; background: #f5f5f5; }
    h1 { margin-top: 0; }
    #status { margin: 8px 0 16px; color: #666; font-size: 14px; }
    table { width: 100%; border-collapse: collapse; background: #fff; }
    th, td { padding: 8px 10px; border-bottom: 1px solid #eee; font-size: 14px; vertical-align: top; }
    th { background: #fafafa; text-align: left; }
    tr:hover { background: #f0f7ff; }
    .id-link { font-weight: 600; color: #0066cc; text-decoration: none; }
    .id-link:hover { text-decoration: underline; }
    .title { font-weight: 500; }
    .body-preview { color: #555; max-width: 600px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .highlight { outline: 2px solid #ff9800; background: #fff3e0 !important; }
    .controls { margin-bottom: 12px; font-size: 14px; }
    .controls input { padding: 4px 6px; font-size: 14px; }
  </style>
</head>
<body>
  <h1>Binance 公告历史</h1>
  <div id="status">正在加载数据...</div>

  <div class="controls">
    通过 ID 跳转：
    <input id="jumpInput" placeholder="例如：BN_01" />
    <button id="jumpBtn">跳转</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>ID</th>
        <th>发布时间</th>
        <th>分类</th>
        <th>标题</th>
        <th>内容预览</th>
      </tr>
    </thead>
    <tbody id="list"></tbody>
  </table>

  <script>
    function formatId(index) {
      const num = index + 1; // 从 1 开始
      return 'BN_' + String(num).padStart(2, '0');
    }

    function getQueryId() {
      const params = new URLSearchParams(window.location.search);
      const fromQuery = params.get('id');
      if (fromQuery) return fromQuery;
      if (window.location.hash) return window.location.hash.substring(1);
      return null;
    }

    function scrollToId(id) {
      const row = document.querySelector(`[data-ann-id="${id}"]`);
      if (row) {
        row.classList.add('highlight');
        row.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }

    async function loadData() {
      const status = document.getElementById('status');
      const tbody = document.getElementById('list');
      status.textContent = '正在从 logs/announcements_history.json 加载...';

      try {
        const res = await fetch('./logs/announcements_history.json');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();

        if (!Array.isArray(data) || data.length === 0) {
          status.textContent = '暂无数据。请先运行监控程序生成 announcements_history.json。';
          return;
        }

        tbody.innerHTML = '';

        data.forEach((item, index) => {
          const id = formatId(index);
          const ann = item.data || {};
          const tr = document.createElement('tr');
          tr.setAttribute('data-ann-id', id);

          const publishTime = ann.publishDate ? new Date(ann.publishDate).toLocaleString() : '';
          const bodyPreview = (ann.body || '').replace(/\s+/g, ' ').slice(0, 120);

          tr.innerHTML = `
            <td><a class="id-link" href="?id=${id}">${id}</a></td>
            <td>${publishTime}</td>
            <td>${ann.catalogName || ''}</td>
            <td class="title">${ann.title || ''}</td>
            <td class="body-preview" title="${(ann.body || '').replace(/"/g, '&quot;')}">${bodyPreview}</td>
          `;

          tbody.appendChild(tr);
        });

        status.textContent = `共加载 ${data.length} 条公告。ID 从 BN_01 开始自增。`;

        const targetId = getQueryId();
        if (targetId) {
          scrollToId(targetId);
        }
      } catch (err) {
        console.error(err);
        status.textContent = '加载失败：' + err.message + '。请确认在同一目录通过 HTTP 方式访问，并且存在 logs/announcements_history.json。';
      }
    }

    document.getElementById('jumpBtn').addEventListener('click', () => {
      const val = document.getElementById('jumpInput').value.trim();
      if (val) {
        const id = val.toUpperCase();
        const url = new URL(window.location.href);
        url.searchParams.set('id', id);
        window.location.href = url.toString();
      }
    });

    window.addEventListener('DOMContentLoaded', loadData);
  </script>
</body>
</html>

